<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace： 1. namespace必须和Mapper接口类路径一致 -->
<mapper namespace="com.item.mapper.UserMapper">
	<!-- 2. id必须和Mapper接口方法名一致 -->
	<!-- 3. parameterType必须和接口方法参数类型一致 -->
	<!-- 4. resultType必须和接口方法返回值类型一致 -->

	<sql id="Base_Column_List">
		userid,nickname, username,password, status, role,phone,registertime
	</sql>

	<!-- 检测用户是否存在 -->
	<select id="userExist" parameterType="string" resultType="int">
		SELECT
		count(*) FROM userinfo WHERE username=#{username}
	</select>

	<!-- 管理用户登录 -->
	<select id="userLogin" parameterType="String" resultType="com.item.entity.UserBean">
		SELECT 
		<include refid="Base_Column_List"></include>
		FROM
		userinfo WHERE username = #{username}
	</select>

	<!-- 管理用户注册 -->
	<insert id="userRegister" parameterType="com.item.entity.UserBean">
		INSERT INTO userinfo
		(`userid`,`nickname`,`username`,`password`,`status`,`role`,`phone`,`registertime`)
		VALUES
		(#{userid},#{nickname},#{username},#{password},#{status},#{role},#{phone},#{registertime})
	</insert>
	
	
		<!-- 根据管理用户名去查询用户信息	 -->
	<select id="queryByName" parameterType="String" resultType="com.item.entity.UserBean">
		select * from userinfo where username = #{username}
	</select>
	
	
	<!-- 根据管理角色身份去查询用户信息 -->
	<select id="queryByRole" parameterType="int" resultType="com.item.entity.UserBean">
		select * from userinfo where role > #{role}
	</select>
	
	
	
	
	
	
	<!-- 检测商城用户是否存在 -->
	<select id="userMessageExist" parameterType="string" resultType="int">
		SELECT
		count(*) FROM usermessage WHERE username=#{username}
	</select>
	
	<!-- 商城用户注册 -->
	<insert id="userMessageRegister" parameterType="com.item.entity.UserMessage">
		INSERT INTO usermessage
		(`userid`,`nickname`,`username`,`password`,`status`,`registertime`,`account`,`email`)
		VALUES
		(#{userid},#{nickname},#{username},#{password},#{status},#{registertime},#{account},#{email})
	</insert>
	
	<!-- 根据商城用户名去查询用户信息	 -->
	<select id="userMessageLogin" parameterType="String" resultType="com.item.entity.UserMessage">
		select * from usermessage where username = #{username}
	</select>
	
	<!-- 通过用户名或者手机号查询(管理页面) -->
	<select id="queryUserBeanByStr" parameterType="String" resultType="com.item.entity.UserBean">
		select * from (select * from userinfo  where  role is not null ) a where username like CONCAT('%',#{str},'%') or phone like CONCAT('%',#{str},'%') 
	</select>

</mapper>