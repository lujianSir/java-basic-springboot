<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace： 1. namespace必须和Mapper接口类路径一致 -->
<mapper namespace="com.item.mapper.FileMapper">
	<!-- 2. id必须和Mapper接口方法名一致 -->
	<!-- 3. parameterType必须和接口方法参数类型一致 -->
	<!-- 4. resultType必须和接口方法返回值类型一致 -->


	<!-- 录入文件信息 -->
	<insert id="fileinfoAdd"
		parameterType="com.item.entity.FileBean">
		INSERT INTO fileinfo
		(`id`,`catalog`,`fileurl`,`role`,`uploadtime`)
		VALUES
		(#{id},#{catalog},#{fileurl},#{role},now())
	</insert>

	<!-- 录入模型信息 -->
	<insert id="modelinfoAdd"
		parameterType="com.item.entity.ModelBean">
		INSERT INTO modelinfo
		(`modelname`,`modelprice`,`buildtype`,`resource_one`,`resource_two`,`filePics`,`fileModel`,`describe`,`creatTime`)
		VALUES
		(#{modelname},#{modelprice},#{buildtype},#{resource_one},#{resource_two},#{filePics},#{fileModel},#{describe},now())
	</insert>
	
	<!-- 模型信息修改 -->
	<update id="modelInfoUpdate" parameterType="com.item.entity.ModelBean">
		update modelinfo 
		<set>
			<if test="modelname!=null and modelname!=''">
			modelname=#{modelname},
			</if>
			<if test="modelprice!=null and modelprice!=''">
				modelprice=#{modelprice},
			</if>
			<if test="buildtype!=null and buildtype!=''">
				buildtype=#{buildtype},
			</if>
			<if test="resource_one!=null and resource_one!=''">
				resource_one=#{resource_one},
			</if>
			<if test="resource_two!=null and resource_two!=''">
				resource_two=#{resource_two},
			</if>
			<if test="filePics!=null and filePics!=''">
				filePics=#{filePics},
			</if>
			<if test="fileModel!=null and fileModel!=''">
				fileModel=#{fileModel},	
			</if>
			<if test="describe!=null and describe!=''">
				describe=#{describe},
			</if>
		</set>	
		where mid=#{mid}	
	</update>

	<!-- 根据名字查询 -->
	<select id="fileinfoQuery" parameterType="String"
		resultType="com.item.entity.FileBean">
		select * from fileinfo where fileurl like "%"#{filename}"%"
	</select>

	<!-- 删除文件信息 -->
	<delete id="fileinfoDelete" parameterType="String">
		DELETE FROM fileinfo WHERE id = #{id}
	</delete>
	
	<!-- 通过ID查询上传的文件 -->
	<select id="selectFileById" resultType="com.item.entity.FileBean">
		select * from fileinfo where id=#{id}
	</select>
	
	<!-- 查询模型封面下所有的信息 -->
	<select id="webStoreQuery" resultType="com.item.entity.FileBean">
		SELECT * FROM `fileinfo` WHERE catalog = '模型封面'
	</select>

	<!-- 查询商城所以的信息 -->
	<select id="queryModels" resultType="com.item.entity.ModelBean">
		select * from modelinfo 
			<where>
				<if test="modelBean.modelname!=null and modelBean.modelname!=''">
					and modelname like  CONCAT('%',#{modelBean.modelname},'%');
				</if>
				<if test="modelBean.buildtype!=null and modelBean.buildtype!=''">
					and buildtype=#{modelBean.buildtype}
				</if>
				<if test="modelBean.resource_one!=null and modelBean.resource_one!=''"> 
					and resource_one=#{modelBean.resource_one}			
				</if>
				<if test="modelBean.resource_two!=null and modelBean.resource_two!=''">
					and resource_two=#{modelBean.resource_two}
				</if>
				<if test="modelBean.modelprice!=201.0 and  modelBean.modelprice != 0.0">
					and modelprice &lt;= #{modelBean.modelprice}
				</if>
				<if test="modelBean.modelprice==201.0 and modelBean.modelprice != 0.0">
					and modelprice &gt; 200
				</if>
				<if test="startPrice != 0.0">
					and modelprice &gt;=#{startPrice}
				</if>
				<if test="endPrice != 0.0">
					and modelprice &lt;= #{endPrice}
				</if>				
			</where>
			
			<if test="orderBy=='' or orderBy== null">
				order by download desc
			</if>			
			<if test="orderBy=='xiazai' and orderBy!='' and orderBy!= null ">
				order by download desc
			</if>	
			<if test="orderBy=='xingji'  and orderBy!='' and orderBy!= null ">
				order by starclass desc
			</if>			
			<if test="orderBy=='shijian'  and orderBy!='' and orderBy!= null ">
				order by creatTime desc
			</if>
						
	</select>

	<!-- 通过ID查询模型的信息 -->
	<select id="queryModelById" resultType="com.item.entity.ModelBean">
		select * from 	modelinfo where mid=#{mid}
	</select>
	
	<!-- 通过ID更改星级以及下载量 -->
	<update id="updateStarAndDownById" parameterType="com.item.entity.ModelBean">
		update modelinfo 
		<set>
			<if test="download!=null and download!=''">
				download=#{download}
			</if>
			<if test="starclass!=null and starclass!=''">
				starclass=#{starclass}
			</if>
		</set>
		where mid=#{mid}
	</update>

</mapper>